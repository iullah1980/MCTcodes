
require("LaplacesDemon")


BF.sim <- function(n1, n2, mu1, mu2, sd1, sd2, size, degf, n.replicate){
  v.sim <- replicate(n.replicate,{
    y1 <- rst(n=n1, mu=mu1, sigma=sd1, nu=degf)
    y2 <- rst(n=n1, mu=mu2, sigma=sd2, nu=degf)
    
    y1.bar <- mean(y1)
    y2.bar <- mean(y2)
    
    var1 <- var(y1)
    var2 <- var(y2)
    
    Tn <- ( y1.bar-y2.bar )/sqrt(var1/n1 + var2/n2)
    
    f <- (var1/n1 + var2/n2)^2 / (var1^2/(n1^3-n1^2) + var2^2/(n2^3-n2^2))
    pT1 <- 2*pt(abs(Tn), f, lower.tail = FALSE)
    
    alpha <- (var1/n1)/(var1/n1+var2/n2)
    TNull <- rnorm(10000)/sqrt(alpha*rchisq(10000,n1-1)/(n1-1)+(1-alpha)*rchisq(10000,n2-1)/(n2-1))
    pT <- mean(abs(TNull) >= abs(Tn))
    
    c(pT1,pT)   
  }
  )
  
  T1p <- mean(v.sim[1,] < size)
  
  TP <- mean(v.sim[2,] < size)
  

  c(T1p,TP)
}


n1 <- c(4,5,8,10,25)
n2 <- c(4,5,8,10,25)

mu1 <- 1

sd1 <- 1
sd2 <- c(16,8,4,2,1,1/2,1/4,1/8,1/16)
degf <- 5
size <- 0.05

M1 <- array(NA, c(length(n1), length(n2), length(sd2)))
M2 <- array(NA, c(length(n1), length(n2), length(sd2)))

n.replicate <- 10000

for (i in 1:length(n1)){
  for (j in 1:length(n2)){
    for (k in 1:length(sd2)){
      
      tau <- 1*sqrt(sd1^2/n1[i]+sd2[k]^2/n2[j])
      mu2 <- mu1+tau
      
      pow.v1 <- BF.sim(n1[i], n2[j], mu1, mu2, sd1, sd2[k],size, degf, n.replicate)
      M1[i, j, k] <- pow.v1[1]
      M2[i, j, k] <- pow.v1[2]
    }
  }
}

M <- list(M1,M2)
save(M, file="tp1.Rdata")


M1 <- array(NA, c(length(n1), length(n2), length(sd2)))
M2 <- array(NA, c(length(n1), length(n2), length(sd2)))

for (i in 1:length(n1)){
  for (j in 1:length(n2)){
    for (k in 1:length(sd2)){
      
      tau <- 2*sqrt(sd1^2/n1[i]+sd2[k]^2/n2[j])
      mu2 <- mu1+tau
      
      pow.v1 <- BF.sim(n1[i], n2[j], mu1, mu2, sd1, sd2[k],size, degf, n.replicate)
      M1[i, j, k] <- pow.v1[1]
      M2[i, j, k] <- pow.v1[2]
    }
  }
}

M <- list(M1,M2)
save(M, file="tp2.Rdata")


M1 <- array(NA, c(length(n1), length(n2), length(sd2)))
M2 <- array(NA, c(length(n1), length(n2), length(sd2)))

for (i in 1:length(n1)){
  for (j in 1:length(n2)){
    for (k in 1:length(sd2)){
      
      tau <- 3*sqrt(sd1^2/n1[i]+sd2[k]^2/n2[j])
      mu2 <- mu1+tau
      
      pow.v1 <- BF.sim(n1[i], n2[j], mu1, mu2, sd1, sd2[k],size, degf, n.replicate)
      M1[i, j, k] <- pow.v1[1]
      M2[i, j, k] <- pow.v1[2]
    }
  }
}

M <- list(M1,M2)
save(M, file="tp2.Rdata")
###################################################
######################################################
library(xtable)

sd1 <- 1
sd2 <- c(16,8,4,2,1,1/2,1/4,1/8,1/16)
rho <- rep(c("1/256","1/64","1/16","1/4",1,4,16,64,256),5)
tau <- rep(c("1/256","1/64","1/16","1/4",1,4,16,64,256),5)
n <- c("","","","",4,"","","","","","","","",5,"","","","",
       "","","","",8,"","","","","","","","",10,"","","","",
       "","","","",25,"","","","")

emp <- c("","","","","","","","","","","","","","","","","","",
         "","","","","","","","","","","","","","","","","","",
         "","","","","","","","","")
load("tp1.Rdata")
R1 <- cbind(c(M[[1]][1,1,],M[[1]][2,2,],M[[1]][3,3,],M[[1]][4,4,],M[[1]][5,5,]),
            c(M[[2]][1,1,],M[[2]][2,2,],M[[2]][3,3,],M[[2]][4,4,],M[[2]][5,5,]))
R1 <- round(R1,3)

load("tp2.Rdata")
R2 <- cbind(c(M[[1]][1,1,],M[[1]][2,2,],M[[1]][3,3,],M[[1]][4,4,],M[[1]][5,5,]),
            c(M[[2]][1,1,],M[[2]][2,2,],M[[2]][3,3,],M[[2]][4,4,],M[[2]][5,5,]))
R2 <- round(R2,3)

load("tp3.Rdata")
R3 <- cbind(c(M[[1]][1,1,],M[[1]][2,2,],M[[1]][3,3,],M[[1]][4,4,],M[[1]][5,5,]),
            c(M[[2]][1,1,],M[[2]][2,2,],M[[2]][3,3,],M[[2]][4,4,],M[[2]][5,5,]))
R3 <- round(R3,3)
Tab <- data.frame(n,rho,tau,R1,emp,R2,emp,R3)
colnames(Tab)=NULL 


print(
  xtable(Tab,digits=c(0,0,0,0,rep(3,8)), label= "RRRRRRRRRRRR"),
  latex.environments=c("center"), 
  floating=FALSE, 
  include.rownames=FALSE
)
######################################################

sd1 <- 1
sd2 <- c(16,8,4,2,1,1/2,1/4,1/8,1/16)
rho <- rep(c("1/256","1/64","1/16","1/4",1,4,16,64,256),4)
tau <- c("4/1280","4/320","4/80","4/20","4/5","16/5","64/5","256/5","1024/5",
         "4/2048","4/512","4/128","4/32","4/8","16/8","64/8","256/8","1024/8",
         "4/2560","4/640","4/160","4/40","4/10","16/10","64/10","256/10","1024/10",
         "4/6400","4/1600","4/400","4/100","4/25","16/25","64/25","256/25","1024/25")

n2 <- c("","","","",5,"","","","",
        "","","","",8,"","","","","","","","",10,"","","","",
        "","","","",25,"","","","")

emp <- c("","","","","","","","","","","","","","","","","","",
         "","","","","","","","","","","","","","","","","","")

load("tp1.Rdata")
R1 <- cbind(c(M[[1]][1,2,],M[[1]][1,3,],M[[1]][1,4,],M[[1]][1,5,]),
            c(M[[2]][1,2,],M[[2]][1,3,],M[[2]][1,4,],M[[2]][1,5,]))
R1 <- round(R1,3)
load("tp2.Rdata")
R2 <- cbind(c(M[[1]][1,2,],M[[1]][1,3,],M[[1]][1,4,],M[[1]][1,5,]),
            c(M[[2]][1,2,],M[[2]][1,3,],M[[2]][1,4,],M[[2]][1,5,]))
R2 <- round(R2,3)
load("tp3.Rdata")
R3 <- cbind(c(M[[1]][1,2,],M[[1]][1,3,],M[[1]][1,4,],M[[1]][1,5,]),
            c(M[[2]][1,2,],M[[2]][1,3,],M[[2]][1,4,],M[[2]][1,5,]))
R3 <- round(R3,3)
Tab <- data.frame(n2,rho,tau,R1,emp,R2,emp,R3)
colnames(Tab)=NULL 


print(
  xtable(Tab,digits=c(0,0,0,0,rep(3,8)), label= "RRRRRRRRRRRR"),
  latex.environments=c("center"), 
  floating=FALSE, 
  include.rownames=FALSE
)

######################################################

sd1 <- 1
sd2 <- c(16,8,4,2,1,1/2,1/4,1/8,1/16)
rho <- rep(c("1/256","1/64","1/16","1/4",1,4,16,64,256),4)
tau <- c("5/1024","5/256","5/64","5/16","5/4","20/4","80/4","320/4","1280/4",
         "5/2048","5/512","5/128","5/32","5/8","20/8","80/8","320/8","1280/8",
         "5/2560","5/640","5/160","5/40","5/10","20/10","80/10","320/10","1280/10",
         "5/6400","5/1600","5/400","5/100","5/25","20/25","80/25","320/25","1280/25")

n2 <- c("","","","",4,"","","","",
        "","","","",8,"","","","","","","","",10,"","","","",
        "","","","",25,"","","","")

emp <- c("","","","","","","","","","","","","","","","","","",
         "","","","","","","","","","","","","","","","","","")

load("tp1.Rdata")
R1 <- cbind(c(M[[1]][2,1,],M[[1]][2,3,],M[[1]][2,4,],M[[1]][2,5,]),
            c(M[[2]][2,1,],M[[2]][2,3,],M[[2]][2,4,],M[[2]][2,5,]))
R1 <- round(R1,3)
load("tp2.Rdata")
R2 <- cbind(c(M[[1]][2,1,],M[[1]][2,3,],M[[1]][2,4,],M[[1]][2,5,]),
            c(M[[2]][2,1,],M[[2]][2,3,],M[[2]][2,4,],M[[2]][2,5,]))
R2 <- round(R2,3)
load("tp3.Rdata")
R3 <- cbind(c(M[[1]][2,1,],M[[1]][2,3,],M[[1]][2,4,],M[[1]][2,5,]),
            c(M[[2]][2,1,],M[[2]][2,3,],M[[2]][2,4,],M[[2]][2,5,]))
R3 <- round(R3,3)
Tab <- data.frame(n2,rho,tau,R1,emp,R2,emp,R3)
colnames(Tab)=NULL 


print(
  xtable(Tab,digits=c(0,0,0,0,rep(3,8)), label= "RRRRRRRRRRRR"),
  latex.environments=c("center"), 
  floating=FALSE, 
  include.rownames=FALSE
)

######################################################

sd1 <- 1
sd2 <- c(16,8,4,2,1,1/2,1/4,1/8,1/16)
rho <- rep(c("1/256","1/64","1/16","1/4",1,4,16,64,256),4)
tau <- c("8/1024","8/256","8/64","8/16","8/4","32/4","128/4","512/4","2048/4",
         "8/1280","8/320","8/80","8/20","8/5","32/5","128/5","512/5","2048/5",
         "8/2560","8/640","8/160","8/40","8/10","32/10","128/10","512/10","2048/10",
         "8/6400","8/1600","8/400","8/100","8/25","32/25","128/25","512/25","2048/25")

n2 <- c("","","","",4,"","","","",
        "","","","",5,"","","","","","","","",10,"","","","",
        "","","","",25,"","","","")

emp <- c("","","","","","","","","","","","","","","","","","",
         "","","","","","","","","","","","","","","","","","")

load("tp1.Rdata")
R1 <- cbind(c(M[[1]][3,1,],M[[1]][3,2,],M[[1]][3,4,],M[[1]][3,5,]),
            c(M[[2]][3,1,],M[[2]][3,2,],M[[2]][3,4,],M[[2]][3,5,]))
R1 <- round(R1,3)

load("tp2.Rdata")
R2 <- cbind(c(M[[1]][3,1,],M[[1]][3,2,],M[[1]][3,4,],M[[1]][3,5,]),
            c(M[[2]][3,1,],M[[2]][3,2,],M[[2]][3,4,],M[[2]][3,5,]))
R2 <- round(R2,3)

load("tp3.Rdata")
R3 <- cbind(c(M[[1]][3,1,],M[[1]][3,2,],M[[1]][3,4,],M[[1]][3,5,]),
            c(M[[2]][3,1,],M[[2]][3,2,],M[[2]][3,4,],M[[2]][3,5,]))
R3 <- round(R3,3)

Tab <- data.frame(n2,rho,tau,R1,emp,R2,emp,R3)
colnames(Tab)=NULL 


print(
  xtable(Tab,digits=c(0,0,0,0,rep(3,8)), label= "RRRRRRRRRRRR"),
  latex.environments=c("center"), 
  floating=FALSE, 
  include.rownames=FALSE
)

######################################################

sd1 <- 1
sd2 <- c(16,8,4,2,1,1/2,1/4,1/8,1/16)
rho <- rep(c("1/256","1/64","1/16","1/4",1,4,16,64,256),4)
tau <- c("10/1024","10/256","10/64","10/16","10/4","40/4","160/4","640/4","2560/4",
         "10/1280","10/320","10/80","10/20","10/5","40/5","160/5","640/5","2560/5",
         "10/2048","10/512","10/128","10/32","10/8","40/10","160/8","640/8","2560/8",
         "10/6400","10/1600","10/400","10/100","10/25","40/25","160/25","640/25","2560/25")

n2 <- c("","","","",4,"","","","",
        "","","","",5,"","","","","","","","",8,"","","","",
        "","","","",25,"","","","")

emp <- c("","","","","","","","","","","","","","","","","","",
         "","","","","","","","","","","","","","","","","","")

load("tp1.Rdata")
R1 <- cbind(c(M[[1]][4,1,],M[[1]][4,2,],M[[1]][4,3,],M[[1]][4,5,]),
            c(M[[2]][4,1,],M[[2]][4,2,],M[[2]][4,3,],M[[2]][4,5,]))
R1 <- round(R1,3)

load("tp2.Rdata")
R2 <- cbind(c(M[[1]][4,1,],M[[1]][4,2,],M[[1]][4,3,],M[[1]][4,5,]),
            c(M[[2]][4,1,],M[[2]][4,2,],M[[2]][4,3,],M[[2]][4,5,]))
R2 <- round(R2,3)

load("tp3.Rdata")
R3 <- cbind(c(M[[1]][4,1,],M[[1]][4,2,],M[[1]][4,3,],M[[1]][4,5,]),
            c(M[[2]][4,1,],M[[2]][4,2,],M[[2]][4,3,],M[[2]][4,5,]))
R3 <- round(R3,3)

Tab <- data.frame(n2,rho,tau,R1,emp,R2,emp,R3)
colnames(Tab)=NULL 


print(
  xtable(Tab,digits=c(0,0,0,0,rep(3,8)), label= "RRRRRRRRRRRR"),
  latex.environments=c("center"), 
  floating=FALSE, 
  include.rownames=FALSE
)

######################################################

sd1 <- 1
sd2 <- c(16,8,4,2,1,1/2,1/4,1/8,1/16)
rho <- rep(c("1/256","1/64","1/16","1/4",1,4,16,64,256),4)
tau <- c("25/1024","25/256","25/64","25/16","25/4","100/4","400/4","1600/4","6400/4",
         "25/1280","25/320","25/80","25/20","25/5","100/5","400/5","1600/5","6400/5",
         "25/2048","25/512","25/128","25/32","25/8","100/10","400/8","1600/8","6400/8",
         "25/2560","25/640","25/160","25/40","25/10","100/10","400/10","1600/10","6400/10")

n2 <- c("","","","",4,"","","","",
        "","","","",5,"","","","","","","","",8,"","","","",
        "","","","",10,"","","","")

emp <- c("","","","","","","","","","","","","","","","","","",
         "","","","","","","","","","","","","","","","","","")

load("tp1.Rdata")
R1 <- cbind(c(M[[1]][5,1,],M[[1]][5,2,],M[[1]][5,3,],M[[1]][5,4,]),
            c(M[[2]][5,1,],M[[2]][5,2,],M[[2]][5,3,],M[[2]][5,4,]))
R1 <- round(R1,3)
load("tp2.Rdata")
R2 <- cbind(c(M[[1]][5,1,],M[[1]][5,2,],M[[1]][5,3,],M[[1]][5,4,]),
            c(M[[2]][5,1,],M[[2]][5,2,],M[[2]][5,3,],M[[2]][5,4,]))
R2 <- round(R2,3)
load("tp3.Rdata")
R3 <- cbind(c(M[[1]][5,1,],M[[1]][5,2,],M[[1]][5,3,],M[[1]][5,4,]),
            c(M[[2]][5,1,],M[[2]][5,2,],M[[2]][5,3,],M[[2]][5,4,]))
R3 <- round(R3,3)
Tab <- data.frame(n2,rho,tau,R1,emp,R2,emp,R3)
colnames(Tab)=NULL 


print(
  xtable(Tab,digits=c(0,0,0,0,rep(3,8)), label= "RRRRRRRRRRRR"),
  latex.environments=c("center"), 
  floating=FALSE, 
  include.rownames=FALSE
)
